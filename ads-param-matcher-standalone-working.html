<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ads Parameter Matcher - Admin (DEMO)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .demo-banner {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .demo-banner strong {
            color: #856404;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .filters {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        select, input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        select:disabled, input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #45a049;
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #2196F3;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #0b7dda;
        }

        .actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #f5f5f5;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background: #f9f9f9;
        }

        .ad-link {
            color: #2196F3;
            text-decoration: none;
            font-weight: 600;
        }

        .ad-link:hover {
            text-decoration: underline;
        }

        .match-count {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .match-count.single {
            background: #4CAF50;
            color: white;
        }

        .match-count.multiple {
            background: #ff9800;
            color: white;
        }

        .chip {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            border: 1px solid #90caf9;
            display: inline-block;
            margin-right: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="demo-banner">
            <strong>⚠️ DEMO MODE:</strong> Using mock data. To use real data, deploy code to production first.
        </div>

        <h1>Ads Parameter Matcher</h1>
        <p class="subtitle">Find ads that mention parameter values in title/description but don't have those parameters linked</p>

        <div class="filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="country">Country</label>
                    <select id="country">
                        <option value="">Select country...</option>
                        <option value="1">Kyrgyzstan (KG)</option>
                        <option value="2">Serbia (RS)</option>
                        <option value="3">Poland (PL)</option>
                        <option value="4">Azerbaijan (AZ)</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="category">Category (Last Level Only)</label>
                    <select id="category" disabled>
                        <option value="">Select category...</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="categorySearch">Or Search by Category ID</label>
                    <input type="number" id="categorySearch" placeholder="Enter category ID..." disabled>
                </div>

                <div class="filter-group">
                    <label for="param">Parameter</label>
                    <select id="param" disabled>
                        <option value="">Select parameter...</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="paramValues">Parameter Values (multiple)</label>
                    <select id="paramValues" multiple disabled style="height: 120px;">
                    </select>
                </div>
            </div>

            <button id="searchBtn" class="btn-primary" onclick="searchDemo()">Search Ads (DEMO)</button>
        </div>

        <div class="actions">
            <div>
                <span id="resultsCount" style="color: #666;">Found 3 ads (demo data)</span>
            </div>
            <button class="btn-secondary" onclick="exportDemo()">Export CSV</button>
        </div>

        <div class="results">
            <table>
                <thead>
                    <tr>
                        <th>Ad ID</th>
                        <th>Title</th>
                        <th>Description</th>
                        <th>Matched Values</th>
                        <th>Match Count</th>
                        <th>Created Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span style="color: #999;">DEMO-1</span></td>
                        <td>Продам Samsung Galaxy S21 <span style="color: #999; font-size: 12px;">(DEMO)</span></td>
                        <td>Новый телефон Samsung в отличном состоянии</td>
                        <td><span class="chip">Samsung</span></td>
                        <td><span class="match-count single">1</span></td>
                        <td>23.01.2026</td>
                        <td><a href="https://lalafo.kg/bishkek/telefony/samsung" target="_blank" class="ad-link">View →</a></td>
                    </tr>
                    <tr>
                        <td><span style="color: #999;">DEMO-2</span></td>
                        <td>iPhone 13 Pro Max <span style="color: #999; font-size: 12px;">(DEMO)</span></td>
                        <td>Айфон 13 в идеальном состоянии, iPhone original</td>
                        <td><span class="chip">iPhone</span> <span class="chip">Айфон</span></td>
                        <td><span class="match-count multiple">2</span></td>
                        <td>22.01.2026</td>
                        <td><a href="https://lalafo.kg/bishkek/telefony/apple" target="_blank" class="ad-link">View →</a></td>
                    </tr>
                    <tr>
                        <td><span style="color: #999;">DEMO-3</span></td>
                        <td>Xiaomi Redmi Note 11 <span style="color: #999; font-size: 12px;">(DEMO)</span></td>
                        <td>Продам Xiaomi в отличном состоянии</td>
                        <td><span class="chip">Xiaomi</span></td>
                        <td><span class="match-count single">1</span></td>
                        <td>21.01.2026</td>
                        <td><a href="https://lalafo.kg/bishkek/telefony/xiaomi" target="_blank" class="ad-link">View →</a></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Mock data for demo - Extended with leaf (last level) categories
        const mockData = {
            categories: {
                '1': [ // Kyrgyzstan - LEAF CATEGORIES ONLY (с реальными ID)
                    {id: 185, name: '[185] Телефоны'},
                    {id: 186, name: '[186] Планшеты'},
                    {id: 187, name: '[187] Ноутбуки'},
                    {id: 188, name: '[188] Настольные компьютеры'},
                    {id: 189, name: '[189] Комплектующие'},
                    {id: 190, name: '[190] Игровые приставки'},
                    {id: 191, name: '[191] Телевизоры'},
                    {id: 192, name: '[192] Аудиотехника'},
                    {id: 193, name: '[193] Фототехника'},
                    {id: 194, name: '[194] Оргтехника'},
                    {id: 195, name: '[195] Бытовая техника'},
                    {id: 285, name: '[285] Легковые автомобили'},
                    {id: 286, name: '[286] Мотоциклы'},
                    {id: 287, name: '[287] Грузовые автомобили'},
                    {id: 385, name: '[385] Квартиры'},
                    {id: 386, name: '[386] Дома'},
                    {id: 387, name: '[387] Земельные участки'}
                ],
                '2': [ // Serbia - LEAF CATEGORIES
                    {id: 2185, name: '[2185] Mobilni telefoni'},
                    {id: 2186, name: '[2186] Tableti'},
                    {id: 2187, name: '[2187] Laptopovi'},
                    {id: 2285, name: '[2285] Automobili'},
                    {id: 2286, name: '[2286] Motocikli'},
                    {id: 2385, name: '[2385] Stanovi'}
                ],
                '3': [ // Poland - LEAF CATEGORIES
                    {id: 3185, name: '[3185] Telefony komórkowe'},
                    {id: 3186, name: '[3186] Tablety'},
                    {id: 3187, name: '[3187] Laptopy'},
                    {id: 3285, name: '[3285] Samochody osobowe'},
                    {id: 3385, name: '[3385] Mieszkania'}
                ],
                '4': [ // Azerbaijan - LEAF CATEGORIES
                    {id: 4185, name: '[4185] Mobil telefonlar'},
                    {id: 4186, name: '[4186] Planşetlər'},
                    {id: 4187, name: '[4187] Noutbuklar'},
                    {id: 4285, name: '[4285] Avtomobillər'},
                    {id: 4385, name: '[4385] Mənzillər'}
                ]
            },
            params: {
                '185': [ // Телефоны (KG)
                    {id: 1, name: 'Бренд'},
                    {id: 2, name: 'Состояние'},
                    {id: 3, name: 'Память'},
                    {id: 4, name: 'Цвет'}
                ],
                '186': [ // Планшеты (KG)
                    {id: 1, name: 'Бренд'},
                    {id: 2, name: 'Состояние'},
                    {id: 3, name: 'Память'}
                ],
                '187': [ // Ноутбуки (KG)
                    {id: 1, name: 'Бренд'},
                    {id: 2, name: 'Состояние'},
                    {id: 5, name: 'Процессор'},
                    {id: 6, name: 'RAM'}
                ],
                '285': [ // Легковые автомобили (KG)
                    {id: 11, name: 'Марка'},
                    {id: 12, name: 'Модель'},
                    {id: 13, name: 'Год выпуска'},
                    {id: 14, name: 'Пробег'}
                ],
                '2185': [ // Mobilni telefoni (RS)
                    {id: 1, name: 'Marka'},
                    {id: 2, name: 'Stanje'},
                    {id: 3, name: 'Memorija'}
                ],
                '3185': [ // Telefony (PL)
                    {id: 1, name: 'Marka'},
                    {id: 2, name: 'Stan'},
                    {id: 3, name: 'Pamięć'}
                ],
                '4185': [ // Mobil telefonlar (AZ)
                    {id: 1, name: 'Marka'},
                    {id: 2, name: 'Vəziyyət'},
                    {id: 3, name: 'Yaddaş'}
                ]
            },
            paramValues: {
                '1': [ // Бренд (KG)
                    {id: 10, value: 'Samsung'},
                    {id: 11, value: 'Apple'},
                    {id: 12, value: 'Xiaomi'},
                    {id: 13, value: 'Huawei'},
                    {id: 14, value: 'Nokia'},
                    {id: 15, value: 'LG'},
                    {id: 16, value: 'Sony'},
                    {id: 17, value: 'Oppo'},
                    {id: 18, value: 'Vivo'},
                    {id: 19, value: 'Realme'}
                ],
                '2': [ // Состояние (KG)
                    {id: 20, value: 'Новое'},
                    {id: 21, value: 'Б/У'},
                    {id: 22, value: 'Отличное'},
                    {id: 23, value: 'Хорошее'}
                ],
                '11': [ // Marka (RS)
                    {id: 110, value: 'Samsung'},
                    {id: 111, value: 'Apple'},
                    {id: 112, value: 'Xiaomi'}
                ],
                '21': [ // Marka (PL)
                    {id: 210, value: 'Samsung'},
                    {id: 211, value: 'Apple'},
                    {id: 212, value: 'Xiaomi'}
                ],
                '31': [ // Marka (AZ)
                    {id: 310, value: 'Samsung'},
                    {id: 311, value: 'Apple'},
                    {id: 312, value: 'Xiaomi'}
                ]
            }
        };

        // Load categories when country changes
        document.getElementById('country').addEventListener('change', function() {
            const countryId = this.value;
            const categorySelect = document.getElementById('category');
            const categorySearch = document.getElementById('categorySearch');
            const paramSelect = document.getElementById('param');
            const paramValuesSelect = document.getElementById('paramValues');

            if (!countryId) {
                categorySelect.disabled = true;
                categorySelect.innerHTML = '<option value="">Select category...</option>';
                categorySearch.disabled = true;
                categorySearch.value = '';
                paramSelect.disabled = true;
                paramSelect.innerHTML = '<option value="">Select parameter...</option>';
                paramValuesSelect.disabled = true;
                paramValuesSelect.innerHTML = '';
                return;
            }

            const categories = mockData.categories[countryId] || [];
            categorySelect.innerHTML = '<option value="">Select category...</option>';
            categories.forEach(cat => {
                categorySelect.innerHTML += `<option value="${cat.id}">${cat.name}</option>`;
            });

            categorySelect.disabled = false;
            categorySearch.disabled = false;
            paramSelect.disabled = true;
            paramSelect.innerHTML = '<option value="">Select parameter...</option>';
            paramValuesSelect.disabled = true;
            paramValuesSelect.innerHTML = '';
        });

        // Handle category search by ID
        document.getElementById('categorySearch').addEventListener('input', function() {
            const countryId = document.getElementById('country').value;
            const categoryId = this.value;
            const categorySelect = document.getElementById('category');
            const paramSelect = document.getElementById('param');

            if (!categoryId) {
                categorySelect.value = '';
                paramSelect.disabled = true;
                return;
            }

            // Try to find category in the list
            const categories = mockData.categories[countryId] || [];
            const found = categories.find(cat => cat.id == categoryId);

            if (found) {
                categorySelect.value = categoryId;
                // Trigger category change event
                loadParams(categoryId);
            } else {
                // Category not found in the list - might be a real category ID
                // Try to load params anyway
                loadParams(categoryId);
            }
        });

        // Sync category select with search input
        document.getElementById('category').addEventListener('change', function() {
            document.getElementById('categorySearch').value = this.value;
            loadParams(this.value);
        });

        function loadParams(categoryId) {
            const paramSelect = document.getElementById('param');
            const paramValuesSelect = document.getElementById('paramValues');

            if (!categoryId) {
                paramSelect.disabled = true;
                paramSelect.innerHTML = '<option value="">Select parameter...</option>';
                paramValuesSelect.disabled = true;
                paramValuesSelect.innerHTML = '';
                return;
            }

            const params = mockData.params[categoryId] || [];
            paramSelect.innerHTML = '<option value="">Select parameter...</option>';
            params.forEach(param => {
                paramSelect.innerHTML += `<option value="${param.id}">${param.name}</option>`;
            });

            paramSelect.disabled = params.length === 0;
            paramValuesSelect.disabled = true;
            paramValuesSelect.innerHTML = '';

            if (params.length === 0) {
                alert(`Category ID ${categoryId} not found in demo data. In production version, this would load real params from API.`);
            }
        }


        // Load param values when param changes
        document.getElementById('param').addEventListener('change', function() {
            const paramId = this.value;
            const paramValuesSelect = document.getElementById('paramValues');

            if (!paramId) {
                paramValuesSelect.disabled = true;
                paramValuesSelect.innerHTML = '';
                return;
            }

            const values = mockData.paramValues[paramId] || [];
            paramValuesSelect.innerHTML = '';
            values.forEach(value => {
                paramValuesSelect.innerHTML += `<option value="${value.id}">${value.value}</option>`;
            });

            paramValuesSelect.disabled = values.length === 0;
        });

        function searchDemo() {
            alert('DEMO MODE: Results shown in the table are mock data.\n\nTo see real results:\n1. Deploy code to production\n2. Open: https://api.lalafo.kg/admin/ads-param-matcher.html\n\nAll filters are working with mock data to demonstrate the interface.');
        }

        function exportDemo() {
            const csvContent = [
                ['Ad ID', 'Title', 'Description', 'Matched Values', 'Match Count', 'Created Date', 'URL'],
                ['DEMO-1', '"Продам Samsung Galaxy S21 (DEMO)"', '"Новый телефон Samsung в отличном состоянии"', '"Samsung"', '1', '23.01.2026', 'https://lalafo.kg/bishkek/telefony/samsung'],
                ['DEMO-2', '"iPhone 13 Pro Max (DEMO)"', '"Айфон 13 в идеальном состоянии, iPhone original"', '"iPhone, Айфон"', '2', '22.01.2026', 'https://lalafo.kg/bishkek/telefony/apple'],
                ['DEMO-3', '"Xiaomi Redmi Note 11 (DEMO)"', '"Продам Xiaomi в отличном состоянии"', '"Xiaomi"', '1', '21.01.2026', 'https://lalafo.kg/bishkek/telefony/xiaomi']
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ads-param-matcher-demo-${Date.now()}.csv`;
            link.click();
        }
    </script>
</body>
</html>
